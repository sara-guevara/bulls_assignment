---
title: "Bulls Assignment_ Transform_and_explore"
author: "Sara G"
date: "25/05/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Opening libraries

```{r librarys}
library(tidyverse)
library(dplyr)
library(broom)
```

# Reading in and tidying Bulls data files

```{r read_data, message=TRUE} 
sal <- read_csv("data/raw/2018-19_nba_player-salaries.csv")
stat_pl <- read_csv("data/raw/2018-19_nba_player_statistics.csv")
stat_tm1 <- read_csv("data/raw/2018-19_nba_team_statistics_1.csv")
stat_tm2 <- read_csv("data/raw/2018-19_nba_team_statistics_2.csv")
pay <- read_csv("data/raw/2019-20_nba_team-payroll.csv")
```

## Check struture

```{r str_team2}
str(stat_tm1)
```

```{r str_team2}
str(stat_tm2)
```


# Tidying data

## Binding data from two data frames
Binding variables from team 1 data and team 2 data

```{r binding}
df_team <- left_join(x = stat_tm2, y = stat_tm1 [-c(1,3, 23:25)],
                     by = "Team")
```

## renaming variables: 
Making sure variables do not include a %, replace with 'p'. And added a 'x' in front of number variables. Change '/' to _per_ .

```{r renaming}
df_team <- df_team %>%
  rename( x3P = '3P', x3PA = '3PA', x3Pp = '3P%', x2P = '2P', x2PA = '2PA', x2Pp = '2P%', FGp = 'FG%', FTp = 'FT%', x3PAr = "3PAr", TSp = "TS%", eFGp = "eFG%", TOVp = "TOV%", ORBp = "ORB%", FT_per_FGA = "FT/FGA", DRBp = "DRB%")
```


## Normalising key metrics

We want normalise the key metrics to per game

```{r Normalising metrics_pg}
df_team <- df_team %>%
  mutate (PTS_per_game = PTS / G,
          WINp = W/G,
          AST_per_game = AST / G,
          FG_per_game = FGA / G, 
          x3P_per_game = x3P / G,
          x2P_per_game = x2PA / G,
          FT_per_game = FTA / G,
          STL_per_game = STL / G,
          BLK_per_game = BLK / G,
          TOV_per_game = TOV / G,
          ORB_per_game = ORB / G,
          DRB_per_game = DRB / G,
          TRB_per_game = TRB / G,
          PF_per_game = PF / G)
```

## Normalising variables per minuted played minutes played
There are 5 players playing roughly 48mins per game. Therefore there are ~240mins per game. WE want normalise these varaibles for the minutes played. 

```{r Normalising metrics_pmp}
df_team <- df_team %>%
  mutate (PTS_pmp = PTS / MP , 
          AST_pmp = AST / MP,
          FG_pmp = FGA / MP, 
          x3P_pmp = x3P / MP ,
          x2P_pmp = x2P / MP ,
          FT_pmp = FTA / MP,
          STL_pmp = STL / MP ,
          BLK_pmp = BLK / MP,
          TOV_pmp = TOV / MP,
          ORB_pmp = ORB / MP,
          DRB_pmp = DRB / MP,
          TRB_pmp = TRB / MP,
          PF_pmp = PF / MP)
        
```

##Check structure of new data set

```{r Str_df_team}
str(df_team)
```


# Explore Data

#Points vs Wins
Points are the outcome variable that are associated with winning but we want to check this.

```{r points_wins}
ggplot(df_team, aes(x =PTS , y = W)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm")

```

## Linear Model for wins in relationship to points
```{r wins_vs PTS}
fit_win = lm(WINp ~ PTS_per_game, data = df_team)
summary(fit_win)
```

Points contribute to 43% of how a team may win. There are other factors that also contribute

```{r wins_vs PTS}
tidy(fit_win, conf.int = TRUE)
```

If we increase out points per game by 1, then we increase our chance of winning by 2%

## Assists and Wins
Lets see how much of the assists contribute to winning. 

```{r assists_wins}
ggplot(df_team, aes(x =AST_per_game , y = WINp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm")

```


```{r Assists_vs win percentage}
fit_ast = lm(WINp ~ AST_per_game, data = df_team)
summary(fit_ast)
```

25% of assists contribute to winning

```{r wins_vs Assists}
tidy(fit_ast, conf.int = TRUE)
```


## Linear Model for wins in relationship to points
```{r wins_vs BLK}
fit_blk = lm(WINp ~ BLK_per_game, data = df_team)
summary(fit_blk)
```

19% of blocks contribute to points

# Points vs Assists


```{r points vs Assists per minute played}
ggplot(df_team, aes(AST_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm")
```


```{r points vs Assists per game}
ggplot(df_team, aes(AST_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.5, nudge_x = 0.5)

```

# Points vs FG


```{r points vs Field Goals per minute played}
ggplot(df_team, aes(FG_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002)

```

```{r points vs Field Goals per game}
ggplot(df_team, aes(x = FG_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.5, nudge_x = 0.5)

```


# Points vs x3P


```{r points vs x3P per minute played}
ggplot(df_team, aes(x3P_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.005, nudge_x = 0.0005) 
 

```


```{r points vs x3P Attempts per game}
ggplot(df_team, aes(x = x3P_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm")
 
```



# Points vs Steals

```{r points vs Steals per minute played}
ggplot(df_team, aes(STL_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.005, nudge_x = 0.001)

```


# Points vs Blocks

```{r points vs Blocks per minute played}
ggplot(df_team, aes(BLK_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.003, nudge_x = 0.0005)

```


```{r points vs Blocks per game}
ggplot(df_team, aes(BLK_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.5, nudge_x = 0.25)

```



# Points vs Free Throws

```{r points vs Free Throws per minute played}
ggplot(df_team, aes(FT_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002, size = 3)

```


```{r points vs Free Throw per game}
ggplot(df_team, aes(FT_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.5, nudge_x = 0.25, size = 3)

```


# Points vs Offensive Rebounds

```{r points vs Off Rebounds per minute played}
ggplot(df_team, aes(ORB_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002, size = 3)

```


```{r points vs Off Rebounds per game}
ggplot(df_team, aes(ORB_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002, size = 3)

```





# Points vs defensive Rebounds

```{r points vs Defensive Rebounds per minute played}
ggplot(df_team, aes(DRB_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002, size = 3)

```

```{r points vs Defensive Rebounds per game}
ggplot(df_team, aes(DRB_per_game, y = PTS_per_game)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002, size = 3)

```


# Points vs Total Rebounds

```{r points vs total per minute played}
ggplot(df_team, aes(TRB_pmp, y = PTS_pmp)) +
  geom_point(alpha = 0.5, colour = "purple") +
  geom_smooth(method = "lm") +
  geom_text(aes(label = Team), nudge_y = 0.002, nudge_x = 0.002, size = 3)

```



## Checking for confounding variables

```{r confounding}
pairs(formula = ~ PTS_pmp + AST_pmp + FG_pmp + x3P_pmp + x2P_pmp + FT_pmp + STL_pmp + BLK_pmp + TOV_pmp + DRB_pmp + ORB_pmp + TRB_pmp, data = df_team)
```

```{r confounding2}
pairs(formula = ~ PTS_pmp+ AST_pmp + FG_pmp + x3P_pmp + x2P_pmp + FT_pmp, data = df_team)
```
There are no obvious correlationship between this data


## Multiple Regression

```{r MLR per game}
lm_teams_pg <- lm(PTS_per_game ~ AST_per_game + FG_per_game + x3P_per_game + x2P_per_game + FT_per_game + STL_per_game + BLK_per_game + TOV_per_game + DRB_per_game + ORB_per_game + TRB_per_game, data = df_team)
tidy(lm_teams_pg, conf.int = TRUE)
```

```{r MLR WIN percentage vs other variables}
lm_teams_wp <- lm(WINp ~ AST_per_game + FG_per_game + x3P_per_game + x2P_per_game + FT_per_game, data = df_team)
tidy(lm_teams_wp, conf.int = TRUE)
```


```{r summary per game}
summary(lm_teams_wp)
```


```{r MLR per minute played}
lm_teams_pmp <- lm(PTS_pmp ~ AST_pmp + FG_pmp + x3P_pmp + x2P_pmp + FT_pmp + STL_pmp + BLK_pmp + TOV_pmp + DRB_pmp + ORB_pmp + TRB_pmp, data = df_team)
tidy(lm_teams_pmp, conf.int = TRUE)
```

```{r summary per minute played}
summary(lm_teams_pmp)
```


## Multiple Regression

```{r MLR per game}
lm_teams_pg <- lm(PTS_per_game ~ AST_per_game + FG_per_game + x3P_per_game + x2P_per_game + FT_per_game + STL_per_game + BLK_per_game + TOV_per_game + DRB_per_game + ORB_per_game, data = df_team)
tidy(lm_teams_pg, conf.int = TRUE)
```

Eliminate variables that have no relationship

```{r per gam MLR}
fit_pg <- lm(PTS_per_game ~ AST_per_game + FG_per_game + x3P_per_game + x2P_per_game + FT_per_game, data = df_team)
tidy(fit_pg, conf.int = TRUE)
```





